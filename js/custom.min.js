function ajaxRequest(a,b,c,e,m,d,n){$(d).ajaxStart(function(){$(this).show()});$(d).ajaxStop(function(){$(this).hide()});var l;$("#waiting_img").show();$.ajax({type:a,url:b,data:c,async:e,dataType:m,cache:!1,success:function(a){l=a;$("#waiting_img").hide()},error:function(){},complete:function(a){}});return l}
function saveform(a){console.log($("button#submit").text());$('<p class="thanx" id="thanx">Danke</p>').prependTo("form#add_form #dialogContent");var b=$("form#"+a).serialize();ajaxRequest("POST","ajax/ajax.php",{func:"insert",formdata:b},!1,"html","#waiting_img",".ui-btn");reset(a);setTimeout(function(){$("#thanx").remove()},2500)}
function saveopinion(a,b){var c=$("form#"+a).serialize();ajaxRequest("POST","ajax/ajax.php",{func:"insertOpinion",data:c+("&id="+b)},!1,"html","#waiting_img",".ui-btn");reset(a);$("#"+a).show()}function reset(a){$("#"+a)[0].reset()}function reload(){$('article[id*="article-"]').remove();$("#btn_more").parent("div").show();getRows(0)}function add(a){$('article[id*="article-"]').remove();$("#"+a).show();$("#btn_more").parent("div").show()}
function moreRows(){$("#waiting_img").show();setTimeout(function(){var a=$("article").last().attr("data-count");getRows(a)},250)}
function formatResult(a,b,c){$.each(a,function(a,b){b=a+parseInt(c)+1;var d=this.pfuscher_id;b&&($('<article id="article-'+d+'" data-count="'+d+'" class="articles"><figure id="article-img-'+d+'"><object data="src/images/no_image.svg" type="image/svg+xml"></object></figure><header>'+this.title+'</header><p class="desc">'+this.description+'</p><div id="awards-'+d+'"></div><div id="nominate-'+d+'"></div><div id="opinion-'+d+'"></div></article>').appendTo("section"),$.each(this.award,function(a,b){var c=
0,g=0,h=0;if("undefined"!=typeof b.votes||b.votes)c=b.votes;if("undefined"!=typeof b.opinion){b.opinion.pro&&(g=b.opinion.pro);b.opinion.con&&(h=b.opinion.con);var f=c,e=!1,k;k=Math.ceil(g/f*3E3/100*1);0==k&&(k=1);30<k&&(k=30);f=Math.ceil(h/f*3E3/100*1);0==f&&(f=1);30<f&&(f=30);e=c/g;e=2>=e&&2>=c/h?!1:2>=e?!0:!1}$('<figure id="awn-'+d+"-"+b.award_id+'"><span class="opinion-bar"><span class="opinion-bar-wrapper" ><span title="JA '+g+' Stimmen" id="oppro-'+d+"-"+b.award_id+'" class="opinion-bar-value" style="height:'+
k+'px"></span><span title="NEIN '+h+' Stimmen" id="opcon-'+d+"-"+b.award_id+'" class="opinion-bar-value con" style="height:'+f+'px"></span></span></span><img id="img-'+d+"-"+b.award_id+'" data-value="'+c+'" class="nominate-this" title="'+b.title+" Stand: "+g+"/"+h+" Stimmen (Nominierungen: "+c+')" alt="'+b.title+'" id="aw-'+d+"-"+b.award_id+'" src="src/images/no_award.png"><p id="votes-'+d+"-"+b.award_id+'">'+c+'</p><div id="desc-'+d+"-"+b.award_id+'">'+b.description+"</div></figure>").appendTo("div#awards-"+
d);e&&($("#img-"+d+"-"+b.award_id).addClass("awarded"),$("#img-"+d+"-"+b.award_id).attr("title",b.title+" GEWONNEN mit "+g+"/"+h+" Stimmen (Nominierungen: "+c+")"))}),nominateDialog())})}
function getRows(a){a?(a=$(".articles").length,"end"==$("article").last().attr("data-count")&&(a="end")):a=0;if("end"!=a)var b=ajaxRequest("GET","ajax/ajax.php",{func:"getRows",table:"pfuscher",field:"",pk:"",id:"",last:a},!1,"json",".ui-loader",".ui-btn");b?b.status?($("#btn_more").parent("div").hide(),$('<article id="article-end" data-count="end" class="articles">'+b.message+"</article>").appendTo("section"),end=!0):formatResult(b,void 0,a):$("#waiting_img").hide()}
function showChanges(a){$("p#"+a).animate({opacity:"0.0",fontSize:"0.1em"});var b=$("p#"+a).text();setTimeout(function(){var c=parseInt(b)+1;$("#"+a).prev("img").attr("data-value",c);$("#"+a).addClass("valuesReCalc").text(c).animate({opacity:"0.5",fontSize:"1em"})},750)}
function nominateDialog(){$("img.nominate-this").off("click");$("img.nominate-this").on("click",function(a){a.preventDefault();1>$(this).attr("data-value")?$("#dialogOpinionNow").hide():$("#dialogOpinionNow").show();$("a#dialogNominateNow").removeClass("ui-disabled");$("a#dialogNominateNow span.ui-btn-text").text("Submit");$("a#dialogOpinionForm").removeClass("ui-disabled");$("a#dialogNominateNow span.ui-btn-text").text("Jetzt nominieren");a=$("#"+this.id).parent().parent().parent().children("header").text();
var b=$("#"+this.id).clone(),c=$("#"+this.id).next().next().clone(),c=$(c).show(),e=this.id;$.mobile.changePage("#dialogPage","dialog",!0,!0);$("div#dialogHeader h2").text(a);$("form#opinion_form div#dialogContent").children().first("h3").html(this.alt).append(b).append(c);$("a#dialogNominateNow").off("click");$("a#dialogNominateNow").on("click",function(a){a.preventDefault();nominate(e);$("a#dialogNominateNow").addClass("ui-disabled");$("a#dialogNominateNow span.ui-btn-text").text("Danke")});$("a#dialogOpinionForm").off("click");
$("a#dialogOpinionForm").on("click",function(a){a.preventDefault();saveopinion("opinion_form",e);$("a#dialogOpinionForm").addClass("ui-disabled");$("a#dialogOpinionForm span.ui-btn-text").text("Danke")});delete e})}
function search(a){$("#waiting_img").show();var b=a.length;2<b&&setTimeout(function(){var b=ajaxRequest("GET","ajax/ajax.php",{func:"search",data:a},!1,"json","#waiting_img",".ui-btn");b&&!b.status&&(document.onscroll=function(){},$("#btn_more").parent("div").hide(),$('article[id*="article-"]').remove(),formatResult(b,0,0))},250);0==b&&(reload(),document.onscroll=function(){$("#waiting_img").show();setTimeout(function(){var a=$("article").last().attr("data-count");getRows(a)},250)})}
function nominate(a){a=ajaxRequest("POST","ajax/ajax.php",{func:"nominate",data:a},!1,"html","#waiting_img",".ui-btn");showChanges(a)}function navshowhide(){$("nav").animate(function(){$("nav ul").slideDown("fast")},function(){$("nav ul").slideUp("fast")})}function navhide(){$("nav").show("slide",{direction:"right"},1E3)}$(document).ready(function(){$(getRows(0));document.onscroll=function(){$("#waiting_img").show();setTimeout(function(){var a=$("article").last().attr("data-count");getRows(a)},250)}});
$(document.body).on("tap","a",function(a){var b=this.getAttribute("href");!a.defaultPrevented&&b&&(a.preventDefault(),location.href=b)}).on("click","a",function(a){a.preventDefault()});